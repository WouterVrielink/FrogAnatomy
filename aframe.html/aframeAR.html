<!DOCTYPE html>
<html>
<head>
  <title>Aframe</title>
  <script src="../aframe/aframe.min.js"></script>
  <script src='../three/js/libs/inflate.min.js'></script>
  <script src="../three/build/three.js"></script>
  <script src="../three/js/controls/TrackballControls.js"></script>
  <script src="../three/js/loaders/VTKLoader.js"></script>
  <script src="../three/js/Detector.js"></script>
  <script src="../three/js/libs/stats.min.js"></script>  <meta charset="utf-8">
  <script src="../aframe/aframe-ar.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>

<style>
#a-scene {
  position: absolute;
}
#canvas {
  position: absolute;
  background-color:lightgrey
}
#button {
  position:absolute;
  left:0%;
  top:0%;
  z-index: 1;
}

.navbarrie {
  position:absolute;
  background-color: rgba(0,0,0,0.5);
  top:0%;
  z-index: 1;
}
.navbar-brand {
  color: rgba(255, 255, 255, 0.9) !important;
}
.navbar-light .navbar-nav .nav-link {
  color: rgba(255, 255, 255, 0.9) !important;
}
.navbar-light .navbar-toggler {
  color: rgba(255, 255, 255, 0.9) !important;
}

.navbar {
  color:white;
}

</style>
</head>
<body>
<div class="col-md-12 navbarrie">
<nav class="navbar navbar-toggleable-md navbar-light bg-faded">
  <button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>
  <a class="navbar-brand" href="#">Pierre</a>
  <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
    <div class="navbar-nav">
      <li class="nav-item dropdown">
        <a class="nav-link">Default</a>
        <a class="nav-link dropdown-toggle" href="http://example.com" id="navbarDropdownMenuLink" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
          BodyParts
        </a>
        <div class="dropdown-menu col-md-8" aria-labelledby="navbarDropdownMenuLink">
          <table class="table">
            <tbody>
              <tr>
                <td onclick="ChangeStuff('Skin')">Skin</td>
                <td onclick="ChangeStuff('Blood')">Blood</td>
                <td onclick="ChangeStuff('Brain')">Brain</td>
                <td onclick="ChangeStuff('Duodenum')">Duodenum</td>
              </tr>
              <tr>
                <td onclick="ChangeStuff('EyeRetina')">Eye Retina</td>
                <td onclick="ChangeStuff('EyeWhite')">Eye White</td>
                <td onclick="ChangeStuff('Heart')">Heart</td>
                <td onclick="ChangeStuff('Ileum')">Ileum</td>
              </tr>
              <tr>
                <td onclick="ChangeStuff('Kidney')">Kidney</td>
                <td onclick="ChangeStuff('LargeIntestine')">Large Intestine</td>
                <td onclick="ChangeStuff('Liver')">Liver</td>
                <td onclick="ChangeStuff('Lung')">Lung</td>
              </tr>
              <tr>
                <td onclick="ChangeStuff('Nerve')">Nerve</td>
                <td onclick="ChangeStuff('Skeleton')">Skeleton</td>
                <td onclick="ChangeStuff('Spleen')">Spleen</td>
                <td onclick="ChangeStuff('Stomach')">Stomach</td>
              </tr>
            </tbody>
          </table>
        </div>
      </li>
    </div>
  </div>
  </nav>
  </div>
  <input type="button" id="button" value="Change Color" />
  <a-scene embedded arjs="trackingMethod: best;">
    <a-anchor hit-testing-enabled='true'>
      <a-entity style="opacity:0.5;"></a-entity>
    </a-anchor>
    <a-camera-static/>
  </a-scene>

  <script>
    var meshesh = {};
    var mesh;

    var onClick = function() {
      console.log("oihgsdiodghgui");
      meshesh["Stomach"].material.color = new THREE.Color(0xffffff * Math.random());
      meshesh["Stomach"].material.opacity = Math.random()
      meshesh["Stomach"].material.needsUpdate = true;
    };


    $('#button').click(onClick);

    init();

    function init() {
      var scene = document.querySelector('a-entity').object3D;

      var beeybeey;
      var rot = { x: 90, y: 0, z: 0 };
      var scale = 0.002;

      var material = new THREE.MeshLambertMaterial( { color: 0xffffff, side: THREE.DoubleSide } );

      var loader1 = new THREE.VTKLoader();
      loader1.load( '../vtkaas/pierre_t_s_d.vtk', function ( geometry ) {

        geometry.computeVertexNormals();
        geometry.center();
        beeybeey = geometry.boundingBox.min

        var material = new THREE.MeshLambertMaterial( { color: 0xf0f0f0, side: THREE.DoubleSide } );
        var mesh = new THREE.Mesh( geometry, material );
        meshesh["Bones"] = mesh;

        mesh.position.set( 0, 0, 0 );
        mesh.scale.multiplyScalar( scale );
        rotateObject( mesh, rot.x, rot.y , rot.z );

        scene.add( mesh );

        load_vtk('../vtkaas/pierre_t_s_d_stomach.vtk', scene, rot, scale, beeybeey, 0x858500, 0.5, "Stomach");

      });
    }

    function load_vtk(fileName, scene, rot, scale, beeybeey, color, opacity, index) {
      var loader = new THREE.VTKLoader();

      loader.load( fileName, function ( geometry ) {

        geometry.computeVertexNormals();
        geometry.translate(beeybeey.x, beeybeey.y, beeybeey.z)

        var material = new THREE.MeshLambertMaterial( { color: color, opacity: opacity, side: THREE.DoubleSide } );
        var mesh = new THREE.Mesh( geometry, material );
        meshesh[index] = mesh;

        mesh.position.set( 0, 0, 0 );
        mesh.scale.multiplyScalar( scale );
        rotateObject( mesh, rot.x, rot.y, rot.z );

        scene.add( mesh );
      })

      return beeybeey ;
    }

    function rotateObject(object,degreeX=0, degreeY=0, degreeZ=0) {
      degreeX = (degreeX * Math.PI) / 180;
      degreeY = (degreeY * Math.PI) / 180;
      degreeZ = (degreeZ * Math.PI) / 180;

      object.rotateX(degreeX);
      object.rotateY(degreeY);
      object.rotateZ(degreeZ);
    }

    function ChangeStuff(organ) {
      console.log(organ);
    }

  </script>
</body>
</html>
